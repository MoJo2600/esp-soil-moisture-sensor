<!DOCTYPE html>
<html>
<head>
  <title>Soil Moisture Sensor</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  <link href='main.css' rel='stylesheet' type='text/css'>
  <!-- <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="144x144"  href="/favicon-144x144.png">
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon.ico"> -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00878f">
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'>
  <script src="jquery-3.3.1.min.js"></script>
  <script src="gauge.min.js"></script>
  <script src="WebSocket.js" type="text/javascript"></script>
</head>

<body>
  <center>
    <header>
      <h1>Soil Moisture Sensor</h1>
    </header>
    <div class="t-speedometer">
      <canvas id="moisture-raw"></canvas>
      <span id="moisture-raw-txt"></span>
    </div>
  </center>
</body>
</html>

<script>
  var opts = {
    angle: -0.4,
    lineWidth: 0.1,
    limitMax: 'true', 
  //  strokeColor: 'red',
    radiusScale: 1,
    pointer: {
      length: 0.5, // // Relative to gauge radius
    },
  //  generateGradient: true,
  //    pointer: {
  //    length: 0.5, // // Relative to gauge radius
  //    strokeWidth: 0.03, // The thickness
  //    color: 'orange' // Fill color
  //  },
  //staticLabels: {
  // font: "90% sans-serif",  // Specifies font
  // labels: [0, 25, 50, 75, 100],  // Print labels at these values
  // color: "black",  // Optional: Label text color
  //  fractionDigits: 2  // Optional: Numerical precision. 0=round off.
  //},  // just experiment with them
    //strokeColor: 'red',   // to see which ones work best for you
  //  staticZones: [
  //   {strokeStyle: "#004478", min: 0, max: 33}, // Yellow
  //   {strokeStyle: "#2E78BC", min: 33, max: 66}, // Green
  //   {strokeStyle: "#88C5F7", min: 66, max: 100}, // Yellow
  //],
    generateGradient: true
  };
  var moisture_raw_target = document.getElementById('moisture-raw'); // your canvas element
  var moisture_raw_gauge = new Gauge(moisture_raw_target).setOptions(opts); // create sexy gauge!
  moisture_raw_gauge.maxValue = 900; // set max gauge value
  moisture_raw_gauge.animationSpeed = 32; // set animation speed (32 is default value)
  moisture_raw_gauge.setMinValue(500);
  moisture_raw_gauge.setTextField(document.getElementById("moisture-raw-txt"));
  //var x = 4;
  //setInterval(gauge.set(x + 3),500);
  //var target = document.getElementById('moisture-raw'); // your canvas element
  //gauge.set(0);

  var connection = new WebSocket('ws://192.168.178.109:81/', ['arduino']);

  connection.onopen = function () {
    connection.send('Connect ' + new Date());
  };

  connection.onerror = function (error) {
    console.log('WebSocket Error ', error);
  };

  connection.onmessage = function (e) {
    console.log('Server: ', e.data);
    JSONobj = JSON.parse(e.data); 
    moisture_raw_gauge.set(parseInt(JSONobj.moisture));
  };

  connection.onclose = function () {
    console.log('WebSocket connection closed');
  };

  // });
  </script>
